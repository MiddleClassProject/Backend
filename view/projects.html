<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Modern Business - Start Bootstrap Template</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Custom Google font-->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@100;200;300;400;500;600;700;800;900&amp;display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.min.css"
    />
    <!-- Bootstrap icons-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="./styles.css" rel="stylesheet" />
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
  </head>
  <body class="d-flex flex-column h-100 bg-light">
    <main class="flex-shrink-0">
      <!-- Navigation-->
      <nav class="navbar navbar-expand-lg navbar-light bg-white py-3">
        <div class="container px-5">
          <a class="navbar-brand" href="index.html"
            ><span class="fw-bolder text-primary">Start Bootstrap</span></a
          >
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0 small fw-bolder">
              <li class="nav-item">
                <a class="nav-link" href="index.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="resume.html">Resume</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="projects.html">Projects</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="contact.html">Contact</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
      <!-- Projects Section-->
      <section class="py-5">
        <div class="container px-5 mb-5">
          <div class="row gx-5 justify-content-center">
            <div class="col-lg-11 col-xl-9 col-xxl-8">
              <!-- Project Card 1-->
              <div id="paymentModal">
                <div id="payment">
                  <span>결제를 요청하시겠습니까?</span>
                  <div id="payChoice">
                    <button id="confirmYes">예</button>
                    <button id="confirmNo">아니요</button>
                  </div>
                </div>
              </div>
              <div
                id="mesCon"
                class="card overflow-hidden shadow rounded-4 border-0 mb-5"
              >
                <div id="msg_container">
                  <ul id="message"></ul>
                </div>
                <div id="chat_container">
                  <form id="chatForm" class="hidden">
                    <i id="paid" class="fa-solid fa-credit-card"></i>
                    <input id="content" autocomplete="off" />
                    <button>전송</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Bootstrap core JS-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      var nickname;
      var socket = io();

      //쿠키에서 값을 가져오기
      function getCookie(name) {
        const value = `; ${document.cookie}`;

        const parts = value.split(`; ${name}=`);
        socket.emit('join', parts[1]);
        if (parts.length == 2) {
          nickname = parts[1];
          return nickname;
        }

        return null;
      }

      let userCookie = getCookie('user_id');

      if (userCookie == null) {
        // 닉네임이 제대로 입력되지 않았다면
        alert('로그인을 해주세요');
      }

      nickname = userCookie;

      // 수신: 신규 클라이언트 접속
      // 수정해야 할 것: 채팅 발신자, 수신자의 아이디가 전부 있어야 함.

      // 수신: 퇴장
      socket.on('left', function (data) {
        updateClientList(data.clientList);
      });

      // 송신: 메시지 전송
      $('form').submit(function () {
        socket.emit('msg', $('#content').val());
        $('#content').val('');
        return false;
      });

      // 수신: 메시지
      socket.on('msg', function (data) {
        console.log('쿠키', userCookie);
        $('#message').append(
          data.nickname === userCookie
            ? $('<li class = "me">').append(
                $('<span class="msg">').text(data.msg)
              )
            : $('<li class = "other">').append(
                $('<span class="nickname">').text(data.nickname + ': '),
                $('<span class="msg">').text(data.msg)
              )
        );
      });
      $(document).ready(function () {
        // 모달 열기
        $('#paid').click(function () {
          $('#paymentModal')
            .css('display', 'flex')
            .dialog({
              modal: true, // 모달 설정
              open: function () {
                $('div[role="dialog"]').css('top', '120px');
              },
              // resizable: true, // 크기 조정 가능
              // draggable: false, // 이동 불가
              width: 'auto', // 내부 컨텐츠에 맞게 크기 자동 조정
              height: '860px',
              top: '120px',
              close: function () {
                $('#paymentModal').css('display', 'none'); // 닫힐 때 display: none 설정
              },
            });
        });

        // "예" 버튼 클릭
        $('#confirmYes').click(function () {
          alert('결제가 요청되었습니다.');
          $('#paymentModal').dialog('close'); // 모달 닫기
        });

        // "아니요" 버튼 클릭
        $('#confirmNo').click(function () {
          alert('결제를 취소하셨습니다.');
          $('#paymentModal').dialog('close'); // 모달 닫기
        });
      });
    </script>
  </body>
</html>